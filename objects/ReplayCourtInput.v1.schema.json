{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://world-engine/contracts/ReplayCourtInput.v1.schema.json",
  "title": "ReplayCourtInput.v1",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version",
    "run_id",
    "kernel_version",
    "topology_contract",
    "loop_mode",
    "tick_hz",
    "tick_count",
    "seed",
    "numeric_policy",
    "seal_policy",
    "object_refs",
    "inputs",
    "expected_invariants"
  ],
  "properties": {
    "schema_version": { "type": "string", "const": "ReplayCourtInput.v1" },
    "run_id": { "type": "string", "minLength": 1 },
    "kernel_version": { "type": "string", "minLength": 1 },
    "topology_contract": { "type": "string", "minLength": 1 },
    "loop_mode": {
      "type": "string",
      "enum": ["LOOP0_AUDIT"]
    },
    "tick_hz": { "type": "integer", "minimum": 1 },
    "tick_count": { "type": "integer", "minimum": 1 },
    "seed": { "type": "integer" },
    "numeric_policy": {
      "type": "object",
      "additionalProperties": false,
      "required": ["mode"],
      "properties": {
        "mode": { "type": "string", "enum": ["FIXED_POINT"] }
      }
    },
    "seal_policy": {
      "type": "object",
      "additionalProperties": false,
      "required": ["seal_every_n_ticks", "seal_on_invariant_breach"],
      "properties": {
        "seal_every_n_ticks": { "type": "integer", "minimum": 1 },
        "seal_on_invariant_breach": { "type": "boolean" }
      }
    },
    "object_refs": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "vehicle_spec_ref",
        "avatar_spec_ref",
        "environment_spec_ref",
        "scenario_spec_ref"
      ],
      "properties": {
        "vehicle_spec_ref": {
          "type": "string",
          "pattern": "^sha256:[0-9a-f]{64}$"
        },
        "avatar_spec_ref": {
          "type": "string",
          "pattern": "^sha256:[0-9a-f]{64}$"
        },
        "environment_spec_ref": {
          "type": "string",
          "pattern": "^sha256:[0-9a-f]{64}$"
        },
        "scenario_spec_ref": {
          "type": "string",
          "pattern": "^sha256:[0-9a-f]{64}$"
        }
      }
    },
    "inputs": {
      "type": "object",
      "additionalProperties": false,
      "required": ["action_stream_ref"],
      "properties": {
        "action_stream_ref": {
          "type": "string",
          "pattern": "^sha256:[0-9a-f]{64}$"
        }
      }
    },
    "expected_invariants": {
      "type": "array",
      "minItems": 1,
      "items": { "type": "string", "minLength": 1 }
    }
  }
}
